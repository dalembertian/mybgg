#!python
# encoding: utf-8
"""
mybgg.py

pip freeze:
    boardgamegeek2==1.0.1

Install with:
    pip install boardgamegeek2
or:
    pip install -e git+git@github.com:lcosmin/boardgamegeek.git#egg=boardgamegeek2

Created by Rubens Altimari on 2017-07-22.
Adapted as a Python package on 2020-04-11, during COVID-19 quarantine :-)
Copyright (c) 2017 Rubens Altimari. All rights reserved.
"""

import codecs
import sys
import locale
import warnings
import argparse

import commands

def main(args):
    """
    Dispatches commands
    """
    if args.stats:
        commands.print_stats(args)
    else:
        collection, games = commands.get_games(args.username)
        if args.owned:
            commands.print_owned(args, collection, games)
        if args.wishlist:
            commands.print_wishlist(args, collection, games)
        if args.designers:
            commands.print_designers(args, collection, games)


if __name__ == '__main__':
    # Accepted arguments & options
    parser = argparse.ArgumentParser()
    parser.add_argument("-v", "--verbose", help="increase output verbosity", action="store_true")
    parser.add_argument("username", help='username at boardgamegeek.com')
    group = parser.add_mutually_exclusive_group(required=True)
    group.add_argument("-o", "--owned", help="prints owned games", action="store_true")
    group.add_argument("-w", "--wishlist", help="prints wishlist", action="store_true")
    group.add_argument("-d", "--designers", help="prints designers", action="store_true")
    parser.add_argument("-b", "--bayesian", help="computes average for designers in a Bayesian way", action="store_true")
    group.add_argument("-s", "--stats", help="prints stats", action="store_true")
    parser.add_argument("-r", "--rank", help="ranking to use for games (default: user)", choices=['geek', 'user', 'weight'], default='user')
    parser.add_argument("-p", "--players", help="filter games for # of players", type=int)
    args = parser.parse_args()

    # If Python 2.x
    if sys.version_info.major < 3:
        # Wrap sys.stdout into a StreamWriter to allow writing unicode
        # (and get rid of UnicodeEncodeError when bash piping)
        sys.stdout = codecs.getwriter(locale.getpreferredencoding())(sys.stdout)

    # Remove FutureWarning warnings, contained in the current version of boardgamegeek2 library
    with warnings.catch_warnings():
        warnings.filterwarnings("ignore", category=FutureWarning)
        main(args)
